#include "thread.h"

/**
 * global variables :
 * list of running threads
 * list of waiting threads
 * pointer on current thread
 * pid generator
 */
struct thread_list *runq = NULL;
struct thread_list* waitq = NULL;
struct thread_t * current = NULL;
int ID;

struct thread_t thread_self(void){

  return current;
}

int thread_create(thread_t *newthread, void *(*func)(void *), void *funcarg){
  struct thread_t* t = malloc(sizeof(struct thread_t));
  t->id = ID++;
  if(getcontext(&(n->uc))== -1)
    return -1;

  n->uc.uc_stack.ss_size = STACK_SIZE;
  n->uc.ic_stack.ss_sp = malloc(n->uc.uc_stack.ss_size);
  if (n->uc.uc_stack.ss_sp == NULL)
	  return -1;

  //n->uc.uc_link = // ??
		
  n->status = READY;
  
  makecontext(&(n->uc), (void (*)(void)) func, 1, funcarg);
  
  //add_thread(runq, n); // TO DO
  
  
}

int thread_yield(void){
  int err = 0;
  //swapcontext(f->head,f->next);
  return err;
  
}

int thread_join(thread_t thread, void **retval){
  int err = 0;
  setcontext(thread.uc);
  return err;
}

void thread_exit(void *retval) __attribute__ ((__noreturn__)) ;
void thread_exit(void *retval){
}
