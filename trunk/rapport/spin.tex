sémaphore

le structure de thread\_spin\_lock est un volatile unsigned int lock, et pour fonctionner le structure, nous avons écrit les fonctions comment:

thread\_spin\_init();
thread\_spin\_destory();
thread\_spin\_lock();
thread\_spin\_unlock();
thread\_spin\_trylock();

Et puis, ce que nous avons programmé est utilisé les language d'assemblage, donc avent chaque fonction, il a besion de mot de clé \_\_asm\_\_ \_\_volatile\_\_.

Pour initialiser le spinlock, il fait lock = 0, et pour destory le spinlock, il fait rien.

Pour la fonction unlock, il doit librer le lock dans le memoire, donc le code est:

"movb \$1,%0": "=m" (lock->lock) : : "memory"

Pour la fonction lock, le code est:

"\n1:\t"
"lock ; decb %0\n\t"
"jns 3f\n"
"2:\t"
"rep;nop\n\t"
"cmpb $0,%0\n\t"
"jle 2b\n\t"
"jmp 1b\n\t"
"3:\n" : "=m"(lock->lock) : : "memory");

les fonctions lock et unlock sont contrôlé le CPU, et regarde si CPU est verrouillé.
  
