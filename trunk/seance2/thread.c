#include "thread.h"




thread_t thread_self(void){
  thread_t t;
  t.status = 0;
  // ucontext_t uc;
  t.uc->uc_stack.ss_size = 64*1024;
  t.uc->uc_stack.ss_sp = malloc(t.uc->uc_stack.ss_size);
  t.uc->uc_link = NULL;
  int err = getcontext(t.uc);

  return t;
}

int thread_create(thread_t *newthread, void *(*func)(void *), void *funcarg){
  
  int err = 0;
  //newthread = &(thread_self());
  newthread->reval = funcarg;
  makecontext((newthread->uc),(void(*)(void)) func, 1, funcarg);

  return err;

}

int thread_yield(void){
  int err = 0;

  return err;
  
}

int thread_join(thread_t thread, void **retval){
  int err = 0;
  setcontext(thread.uc);
  return err;
}

void thread_exit(void *retval) __attribute__ ((__noreturn__)) ;
void thread_exit(void *retval){
}
